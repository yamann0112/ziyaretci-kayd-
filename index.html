<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ziyaret√ßi Takip Sistemi</title>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --text-primary: #ffffff;
            --text-secondary: #b8b8b8;
            --gold: #ffd700;
            --gold-dark: #b8860b;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --border: #2a2a4a;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        .light-theme {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-card: #e8e8e8;
            --text-primary: #1a1a2e;
            --text-secondary: #555555;
            --border: #cccccc;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }

        .sidebar-header h1 {
            color: var(--gold);
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .sidebar-header .subtitle {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .nav-menu {
            list-style: none;
            padding: 15px 0;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-card);
            border-left-color: var(--gold);
        }

        .nav-item.active {
            background: var(--bg-card);
            border-left-color: var(--gold);
            color: var(--gold);
        }

        .nav-item i {
            width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .current-time {
            font-size: 1.2rem;
            color: var(--gold);
            font-weight: 600;
        }

        .vardiya-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .vardiya-gunduz {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: white;
        }

        .vardiya-gece {
            background: linear-gradient(135deg, #2c3e50, #1a1a2e);
            color: white;
            border: 1px solid var(--gold);
        }

        .vardiya-tatil {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            border-color: var(--gold);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            color: var(--gold);
            font-size: 1.1rem;
        }

        .card-body {
            padding: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: #1a1a2e;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: #1a1a2e;
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--gold);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-card);
            color: var(--gold);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        tr:hover {
            background: var(--bg-card);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-inside {
            background: rgba(40, 167, 69, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-outside {
            background: rgba(220, 53, 69, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .type-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .type-sevkiyat { background: #e74c3c22; color: #e74c3c; border: 1px solid #e74c3c; }
        .type-calisma { background: #3498db22; color: #3498db; border: 1px solid #3498db; }
        .type-gorusme { background: #9b59b622; color: #9b59b6; border: 1px solid #9b59b6; }
        .type-servis { background: #f39c1222; color: #f39c12; border: 1px solid #f39c12; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--gold);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border-radius: 25px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .filter-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-row select {
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            min-width: 150px;
        }

        .active-visitors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .visitor-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--border);
            transition: transform 0.2s ease;
        }

        .visitor-card:hover {
            transform: translateY(-2px);
            border-color: var(--gold);
        }

        .visitor-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .visitor-name {
            font-weight: 600;
            color: var(--gold);
            font-size: 1.05rem;
        }

        .visitor-info {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .visitor-info span {
            display: block;
            margin-bottom: 3px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-bottom: none;
        }

        .tab.active {
            background: var(--gold);
            color: #1a1a2e;
        }

        .personnel-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .personnel-category {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .personnel-category-header {
            padding: 15px 20px;
            background: var(--bg-card);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .personnel-category-header h4 {
            color: var(--gold);
        }

        .personnel-list {
            padding: 15px;
            min-height: 200px;
        }

        .personnel-item {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s ease;
            border: 1px solid var(--border);
        }

        .personnel-item:hover {
            border-color: var(--gold);
        }

        .personnel-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .personnel-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .personnel-item-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .note-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
        }

        .note-card.unread {
            border-left: 3px solid var(--gold);
        }

        .note-new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .note-title {
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .note-content {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .announcement-bar {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: #1a1a2e;
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .announcement-scroll {
            white-space: nowrap;
            animation: scroll 20s linear infinite;
        }

        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .announcement-pinned {
            background: var(--bg-card);
            border: 2px solid var(--gold);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .announcement-pinned-title {
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .log-entry {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: var(--gold);
            font-weight: 500;
            margin-right: 10px;
        }

        .log-action {
            color: var(--text-secondary);
        }

        .shift-display {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .shift-day {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .shift-day.today {
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .shift-day-name {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .shift-day-date {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .shift-type {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 10px;
        }

        .puantaj-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .puantaj-item {
            background: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .puantaj-item:hover {
            transform: scale(1.02);
            border-color: var(--gold);
        }

        .puantaj-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .puantaj-item-info {
            padding: 10px;
            text-align: center;
            font-size: 0.85rem;
        }

        .image-modal {
            max-width: 90vw;
            max-height: 90vh;
        }

        .image-modal img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .autocomplete-list.active {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .autocomplete-item:hover {
            background: var(--bg-card);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--gold);
        }

        .additional-persons {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .additional-person-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .toast.active {
            display: block;
        }

        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        .toast.warning { background: var(--warning); color: #1a1a2e; }
        .toast.info { background: var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .backup-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-btn {
                display: block !important;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .shift-display {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .mobile-menu-btn {
            display: none;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        .drag-over {
            background: var(--bg-primary);
            border: 2px dashed var(--gold);
        }

        .confirm-dialog {
            text-align: center;
            padding: 20px;
        }

        .confirm-dialog-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .confirm-dialog-message {
            margin-bottom: 20px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üè¢ ZTS</h1>
                <div class="subtitle">Ziyaret√ßi Takip Sistemi</div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">üìä Dashboard</li>
                <li class="nav-item" data-page="visitors">üë• Ziyaret√ßi Y√∂netimi</li>
                <li class="nav-item" data-page="inside">üö∂ ƒ∞√ßeridekiler</li>
                <li class="nav-item" data-page="personnel">üëî Personel Rehberi</li>
                <li class="nav-item" data-page="notes">üìù Notlar</li>
                <li class="nav-item" data-page="announcements">üì¢ Duyurular</li>
                <li class="nav-item" data-page="puantaj">üñºÔ∏è Puantaj</li>
                <li class="nav-item" data-page="shift">‚è∞ Vardiya</li>
                <li class="nav-item" data-page="logs">üìã Log Kayƒ±tlarƒ±</li>
                <li class="nav-item" data-page="settings">‚öôÔ∏è Ayarlar</li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>
                    <div class="current-time" id="currentTime">00:00:00</div>
                    <div class="vardiya-badge" id="vardiyaBadge">G√ºnd√ºz</div>
                </div>
                <div class="header-right">
                    <button class="theme-toggle" onclick="toggleTheme()">üåô Tema</button>
                </div>
            </header>

            <div id="scrollingAnnouncement" class="announcement-bar" style="display: none;">
                <div class="announcement-scroll" id="scrollingText"></div>
            </div>

            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #ffd700, #b8860b);">üë•</div>
                        <div class="value" id="todayVisitors">0</div>
                        <div class="label">Bug√ºnk√º Ziyaret√ßi</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #28a745, #20c997);">üìä</div>
                        <div class="value" id="totalVisitors">0</div>
                        <div class="label">Toplam Ziyaret√ßi</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #17a2b8, #007bff);">üö∂</div>
                        <div class="value" id="insideCount">0</div>
                        <div class="label">ƒ∞√ßerideki Ziyaret√ßi</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üöö</div>
                        <div class="value" id="sevkiyatCount">0</div>
                        <div class="label">Sevkiyat</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">üîß</div>
                        <div class="value" id="calismaCount">0</div>
                        <div class="label">√áalƒ±≈üma</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">üíº</div>
                        <div class="value" id="gorusmeCount">0</div>
                        <div class="label">G√∂r√º≈üme</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon" style="background: linear-gradient(135deg, #f39c12, #d68910);">üîß</div>
                        <div class="value" id="servisCount">0</div>
                        <div class="label">Servis</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openVisitorModal()">‚ûï Yeni Ziyaret√ßi</button>
                    <button class="btn btn-success" onclick="exportToExcel()">üì§ Excel Export</button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>üìÖ Bug√ºnk√º Kayƒ±tlar</h3>
                        <span id="todayDate"></span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>Firma</th>
                                        <th>Plaka</th>
                                        <th>T√ºr</th>
                                        <th>Giri≈ü</th>
                                        <th>√áƒ±kƒ±≈ü</th>
                                        <th>Durum</th>
                                        <th>ƒ∞≈ülemler</th>
                                    </tr>
                                </thead>
                                <tbody id="todayVisitorsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visitors Page -->
            <div class="page" id="page-visitors">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openVisitorModal()">‚ûï Yeni Ziyaret√ßi</button>
                </div>

                <div class="search-box">
                    <input type="text" id="visitorSearch" placeholder="Ziyaret√ßi ara (Ad, Soyad, Firma, Plaka, Telefon)..." oninput="searchVisitors()">
                </div>

                <div class="filter-row">
                    <select id="filterDate" onchange="filterVisitors()">
                        <option value="">T√ºm Tarihler</option>
                        <option value="today">Bug√ºn</option>
                        <option value="week">Bu Hafta</option>
                        <option value="month">Bu Ay</option>
                    </select>
                    <select id="filterStatus" onchange="filterVisitors()">
                        <option value="">T√ºm Durumlar</option>
                        <option value="inside">ƒ∞√ßeride</option>
                        <option value="outside">√áƒ±kƒ±≈ü Yaptƒ±</option>
                    </select>
                    <select id="filterType" onchange="filterVisitors()">
                        <option value="">T√ºm T√ºrler</option>
                        <option value="sevkiyat">Sevkiyat</option>
                        <option value="calisma">√áalƒ±≈üma</option>
                        <option value="gorusme">G√∂r√º≈üme</option>
                        <option value="servis">Servis</option>
                    </select>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>üìã Ziyaret√ßi Listesi</h3>
                        <span id="visitorCount">0 kayƒ±t</span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>Ad Soyad</th>
                                        <th>Firma</th>
                                        <th>Plaka</th>
                                        <th>Telefon</th>
                                        <th>T√ºr</th>
                                        <th>Giri≈ü</th>
                                        <th>√áƒ±kƒ±≈ü</th>
                                        <th>Durum</th>
                                        <th>ƒ∞≈ülemler</th>
                                    </tr>
                                </thead>
                                <tbody id="allVisitorsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inside Visitors Page -->
            <div class="page" id="page-inside">
                <div class="card">
                    <div class="card-header">
                        <h3>üö∂ ƒ∞√ßerideki Ziyaret√ßiler</h3>
                        <span id="insideVisitorCount">0 ki≈üi</span>
                    </div>
                    <div class="card-body">
                        <div class="active-visitors" id="insideVisitorsList"></div>
                    </div>
                </div>
            </div>

            <!-- Personnel Page -->
            <div class="page" id="page-personnel">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openPersonnelModal()">‚ûï Yeni Personel</button>
                </div>

                <div class="personnel-container">
                    <div class="personnel-category" id="company-personnel">
                        <div class="personnel-category-header">
                            <h4>üè¢ ≈ûirket Personeli</h4>
                            <button class="btn btn-sm btn-secondary" onclick="editCategoryName('company')">‚úèÔ∏è</button>
                        </div>
                        <div class="personnel-list" id="companyList" ondrop="dropPersonnel(event, 'company')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                    </div>
                    <div class="personnel-category" id="project-personnel">
                        <div class="personnel-category-header">
                            <h4>üìÅ Proje Personeli</h4>
                            <button class="btn btn-sm btn-secondary" onclick="editCategoryName('project')">‚úèÔ∏è</button>
                        </div>
                        <div class="personnel-list" id="projectList" ondrop="dropPersonnel(event, 'project')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                    </div>
                </div>
            </div>

            <!-- Notes Page -->
            <div class="page" id="page-notes">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openNoteModal()">‚ûï Yeni Not</button>
                    <button class="btn btn-danger" onclick="deleteAllNotes()">üóëÔ∏è T√ºm√ºn√º Sil</button>
                </div>

                <div class="card">
                    <div class="card-body" id="notesList"></div>
                </div>
            </div>

            <!-- Announcements Page -->
            <div class="page" id="page-announcements">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openAnnouncementModal()">‚ûï Yeni Duyuru</button>
                </div>

                <div id="pinnedAnnouncements"></div>

                <div class="card">
                    <div class="card-header">
                        <h3>üì¢ T√ºm Duyurular</h3>
                    </div>
                    <div class="card-body" id="announcementsList"></div>
                </div>
            </div>

            <!-- Puantaj Page -->
            <div class="page" id="page-puantaj">
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="openPuantajModal()">‚ûï Puantaj Ekle</button>
                </div>

                <div class="filter-row">
                    <input type="month" id="puantajMonth" class="form-control" style="max-width: 200px;" onchange="filterPuantaj()">
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="puantaj-container" id="puantajList"></div>
                    </div>
                </div>
            </div>

            <!-- Shift Page -->
            <div class="page" id="page-shift">
                <div class="card">
                    <div class="card-header">
                        <h3>‚è∞ Vardiya Takvimi</h3>
                    </div>
                    <div class="card-body">
                        <div class="shift-display" id="shiftCalendar"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>üë§ Joker Personel</h3>
                        <button class="btn btn-sm btn-primary" onclick="openJokerModal()">‚ûï Ekle</button>
                    </div>
                    <div class="card-body">
                        <div id="jokerList"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>‚öôÔ∏è Vardiya Ayarlarƒ±</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß Tarihi (6 g√ºnl√ºk d√∂ng√º)</label>
                            <input type="date" id="shiftStartDate" class="form-control" style="max-width: 200px;" onchange="saveShiftSettings()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Page -->
            <div class="page" id="page-logs">
                <div class="card">
                    <div class="card-header">
                        <h3>üìã ƒ∞≈ülem Ge√ßmi≈üi</h3>
                        <button class="btn btn-sm btn-danger" onclick="clearOldLogs()">üóëÔ∏è Eski Loglarƒ± Temizle</button>
                    </div>
                    <div class="card-body" id="logsList"></div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="card">
                    <div class="card-header">
                        <h3>üíæ Veri Y√∂netimi</h3>
                    </div>
                    <div class="card-body">
                        <div class="backup-section">
                            <button class="btn btn-primary" onclick="exportAllData()">üì§ T√ºm Verileri Dƒ±≈üa Aktar</button>
                            <button class="btn btn-success" onclick="document.getElementById('importFile').click()">üì• Veri ƒ∞√ße Aktar</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importAllData(event)">
                            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è T√ºm Verileri Sil</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3">üìä Veri ƒ∞statistikleri</h3>
                    </div>
                    <div class="card-body">
                        <p>Toplam Ziyaret√ßi: <strong id="statsVisitors">0</strong></p>
                        <p>Toplam Personel: <strong id="statsPersonnel">0</strong></p>
                        <p>Toplam Not: <strong id="statsNotes">0</strong></p>
                        <p>Toplam Duyuru: <strong id="statsAnnouncements">0</strong></p>
                        <p>Toplam Log: <strong id="statsLogs">0</strong></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Visitor Modal -->
    <div class="modal" id="visitorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="visitorModalTitle">Yeni Ziyaret√ßi</h3>
                <button class="modal-close" onclick="closeModal('visitorModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="visitorId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ad *</label>
                        <div style="position: relative;">
                            <input type="text" id="visitorFirstName" class="form-control" oninput="showAutocomplete(this, 'firstName')">
                            <div class="autocomplete-list" id="autocomplete-firstName"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Soyad *</label>
                        <input type="text" id="visitorLastName" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Firma</label>
                        <div style="position: relative;">
                            <input type="text" id="visitorCompany" class="form-control" oninput="showAutocomplete(this, 'company')">
                            <div class="autocomplete-list" id="autocomplete-company"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="visitorPhone" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Plaka</label>
                        <div style="position: relative;">
                            <input type="text" id="visitorPlate" class="form-control" oninput="showAutocomplete(this, 'plate')">
                            <div class="autocomplete-list" id="autocomplete-plate"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ziyaret T√ºr√º *</label>
                        <select id="visitorType" class="form-control">
                            <option value="sevkiyat">Sevkiyat</option>
                            <option value="calisma">√áalƒ±≈üma</option>
                            <option value="gorusme">G√∂r√º≈üme</option>
                            <option value="servis">Servis</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>G√∂r√º≈ü√ºlecek Ki≈üi</label>
                    <input type="text" id="visitorContact" class="form-control">
                </div>
                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <textarea id="visitorNote" class="form-control" rows="2"></textarea>
                </div>
                <div class="additional-persons">
                    <h4 style="margin-bottom: 10px;">Ara√ßtaki Diƒüer Ki≈üiler</h4>
                    <div id="additionalPersonsList"></div>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="addAdditionalPerson()">‚ûï Ki≈üi Ekle</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('visitorModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveVisitor()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Personnel Modal -->
    <div class="modal" id="personnelModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="personnelModalTitle">Yeni Personel</h3>
                <button class="modal-close" onclick="closeModal('personnelModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="personnelId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ad *</label>
                        <input type="text" id="personnelFirstName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Soyad *</label>
                        <input type="text" id="personnelLastName" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pozisyon</label>
                        <input type="text" id="personnelPosition" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="personnelPhone" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Plaka</label>
                        <input type="text" id="personnelPlate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Kategori *</label>
                        <select id="personnelCategory" class="form-control">
                            <option value="company">≈ûirket Personeli</option>
                            <option value="project">Proje Personeli</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('personnelModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="savePersonnel()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni Not</h3>
                <button class="modal-close" onclick="closeModal('noteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="noteId">
                <div class="form-group">
                    <label>Ba≈ülƒ±k *</label>
                    <input type="text" id="noteTitle" class="form-control">
                </div>
                <div class="form-group">
                    <label>ƒ∞√ßerik *</label>
                    <textarea id="noteContent" class="form-control" rows="4"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Biti≈ü Tarihi</label>
                        <input type="date" id="noteEndDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Resim</label>
                        <input type="file" id="noteImage" class="form-control" accept="image/*">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('noteModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveNote()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div class="modal" id="announcementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni Duyuru</h3>
                <button class="modal-close" onclick="closeModal('announcementModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="announcementId">
                <div class="form-group">
                    <label>Duyuru Metni *</label>
                    <textarea id="announcementText" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>T√ºr *</label>
                        <select id="announcementType" class="form-control">
                            <option value="scrolling">Kayan Duyuru</option>
                            <option value="pinned">Sabit Duyuru</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Biti≈ü Tarihi</label>
                        <input type="date" id="announcementEndDate" class="form-control">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('announcementModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Puantaj Modal -->
    <div class="modal" id="puantajModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Puantaj Ekle</h3>
                <button class="modal-close" onclick="closeModal('puantajModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tarih *</label>
                    <input type="date" id="puantajDate" class="form-control">
                </div>
                <div class="form-group">
                    <label>Resim *</label>
                    <input type="file" id="puantajImage" class="form-control" accept="image/*">
                </div>
                <div class="form-group">
                    <label>A√ßƒ±klama</label>
                    <input type="text" id="puantajDescription" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('puantajModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="savePuantaj()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Image View Modal -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-modal">
            <div class="modal-header">
                <h3 id="imageModalTitle">Resim</h3>
                <button class="modal-close" onclick="closeModal('imageModal')">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <img id="modalImage" src="" alt="Puantaj" style="max-width: 100%;">
            </div>
        </div>
    </div>

    <!-- Joker Modal -->
    <div class="modal" id="jokerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Joker Personel Ekle</h3>
                <button class="modal-close" onclick="closeModal('jokerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Ad Soyad *</label>
                    <input type="text" id="jokerName" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('jokerModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveJoker()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-body">
                <div class="confirm-dialog">
                    <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                    <h3 id="confirmTitle">Emin misiniz?</h3>
                    <p class="confirm-dialog-message" id="confirmMessage"></p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closeModal('confirmModal')">ƒ∞ptal</button>
                        <button class="btn btn-danger" id="confirmButton">Evet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // T√ºrkiye saati - UTC+3
        function getTurkeyTime() {
            const now = new Date();
            const turkeyOffset = 3 * 60;
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            return new Date(utc + (turkeyOffset * 60000));
        }

        function formatDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('tr-TR');
        }

        function formatTime(date) {
            const d = new Date(date);
            return d.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatDateTime(date) {
            return formatDate(date) + ' ' + formatTime(date);
        }

        // LocalStorage functions
        function getData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        function setData(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        // Initialize data
        function initData() {
            if (!getData('visitors')) setData('visitors', []);
            if (!getData('personnel')) setData('personnel', []);
            if (!getData('notes')) setData('notes', []);
            if (!getData('announcements')) setData('announcements', []);
            if (!getData('puantaj')) setData('puantaj', []);
            if (!getData('logs')) setData('logs', []);
            if (!getData('jokers')) setData('jokers', []);
            if (!getData('settings')) setData('settings', {
                theme: 'dark',
                shiftStartDate: getTurkeyTime().toISOString().split('T')[0],
                categoryNames: { company: '≈ûirket Personeli', project: 'Proje Personeli' }
            });
        }

        // Logging
        function addLog(action) {
            const logs = getData('logs') || [];
            logs.unshift({
                id: Date.now(),
                action: action,
                timestamp: getTurkeyTime().toISOString()
            });
            // Keep only last 7 days
            const weekAgo = new Date(getTurkeyTime().getTime() - 7 * 24 * 60 * 60 * 1000);
            const filtered = logs.filter(log => new Date(log.timestamp) > weekAgo);
            setData('logs', filtered);
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast active ' + type;
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Theme
        function toggleTheme() {
            const body = document.body;
            const settings = getData('settings');
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                settings.theme = 'dark';
            } else {
                body.classList.add('light-theme');
                settings.theme = 'light';
            }
            setData('settings', settings);
        }

        function loadTheme() {
            const settings = getData('settings');
            if (settings && settings.theme === 'light') {
                document.body.classList.add('light-theme');
            }
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                item.classList.add('active');
                document.getElementById('page-' + item.dataset.page).classList.add('active');
                loadPageData(item.dataset.page);
            });
        });

        function loadPageData(page) {
            switch(page) {
                case 'dashboard': loadDashboard(); break;
                case 'visitors': loadVisitors(); break;
                case 'inside': loadInsideVisitors(); break;
                case 'personnel': loadPersonnel(); break;
                case 'notes': loadNotes(); break;
                case 'announcements': loadAnnouncements(); break;
                case 'puantaj': loadPuantaj(); break;
                case 'shift': loadShift(); break;
                case 'logs': loadLogs(); break;
                case 'settings': loadSettings(); break;
            }
        }

        // Mobile sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Clock and Shift
        function updateClock() {
            const now = getTurkeyTime();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('tr-TR');
            updateVardiya(now);
        }

        function updateVardiya(now) {
            const hour = now.getHours();
            const badge = document.getElementById('vardiyaBadge');
            const settings = getData('settings');
            
            // Calculate shift based on 6-day cycle
            const startDate = new Date(settings.shiftStartDate);
            const diffTime = now.getTime() - startDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const cycleDay = ((diffDays % 6) + 6) % 6;
            
            // Cycle: 2 days G√ºnd√ºz, 2 days Gece, 2 days Tatil
            let shiftType;
            if (cycleDay < 2) {
                shiftType = 'gunduz';
                badge.textContent = '‚òÄÔ∏è G√ºnd√ºz Vardiyasƒ±';
                badge.className = 'vardiya-badge vardiya-gunduz';
            } else if (cycleDay < 4) {
                shiftType = 'gece';
                badge.textContent = 'üåô Gece Vardiyasƒ±';
                badge.className = 'vardiya-badge vardiya-gece';
            } else {
                shiftType = 'tatil';
                badge.textContent = 'üå¥ Tatil';
                badge.className = 'vardiya-badge vardiya-tatil';
            }
        }

        // Dashboard
        function loadDashboard() {
            const visitors = getData('visitors') || [];
            const today = getTurkeyTime().toISOString().split('T')[0];
            
            const todayVisitors = visitors.filter(v => v.date === today);
            const insideVisitors = visitors.filter(v => !v.exitTime);
            
            document.getElementById('todayVisitors').textContent = todayVisitors.length;
            document.getElementById('totalVisitors').textContent = visitors.length;
            document.getElementById('insideCount').textContent = insideVisitors.length;
            
            const typeCounts = { sevkiyat: 0, calisma: 0, gorusme: 0, servis: 0 };
            todayVisitors.forEach(v => {
                if (typeCounts[v.type] !== undefined) typeCounts[v.type]++;
            });
            
            document.getElementById('sevkiyatCount').textContent = typeCounts.sevkiyat;
            document.getElementById('calismaCount').textContent = typeCounts.calisma;
            document.getElementById('gorusmeCount').textContent = typeCounts.gorusme;
            document.getElementById('servisCount').textContent = typeCounts.servis;
            
            document.getElementById('todayDate').textContent = formatDate(getTurkeyTime());
            
            renderTodayTable(todayVisitors);
        }

        function renderTodayTable(visitors) {
            const tbody = document.getElementById('todayVisitorsTable');
            if (visitors.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Bug√ºn hen√ºz ziyaret√ßi yok</td></tr>';
                return;
            }
            
            tbody.innerHTML = visitors.map(v => `
                <tr>
                    <td>${v.firstName} ${v.lastName}</td>
                    <td>${v.company || '-'}</td>
                    <td>${v.plate || '-'}</td>
                    <td><span class="type-badge type-${v.type}">${getTypeName(v.type)}</span></td>
                    <td>${formatTime(v.entryTime)}</td>
                    <td>${v.exitTime ? formatTime(v.exitTime) : '-'}</td>
                    <td><span class="status-badge ${v.exitTime ? 'status-outside' : 'status-inside'}">${v.exitTime ? '√áƒ±kƒ±≈ü' : 'ƒ∞√ßeride'}</span></td>
                    <td class="action-buttons">
                        ${!v.exitTime ? `<button class="btn btn-sm btn-success" onclick="checkoutVisitor('${v.id}')">√áƒ±kƒ±≈ü</button>` : ''}
                        <button class="btn btn-sm btn-warning" onclick="editVisitor('${v.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteVisitor('${v.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function getTypeName(type) {
            const names = { sevkiyat: 'Sevkiyat', calisma: '√áalƒ±≈üma', gorusme: 'G√∂r√º≈üme', servis: 'Servis' };
            return names[type] || type;
        }

        // Visitors
        function loadVisitors() {
            filterVisitors();
        }

        function filterVisitors() {
            let visitors = getData('visitors') || [];
            const search = document.getElementById('visitorSearch').value.toLowerCase();
            const dateFilter = document.getElementById('filterDate').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterType').value;
            
            const today = getTurkeyTime();
            
            if (search) {
                visitors = visitors.filter(v => 
                    v.firstName.toLowerCase().includes(search) ||
                    v.lastName.toLowerCase().includes(search) ||
                    (v.company && v.company.toLowerCase().includes(search)) ||
                    (v.plate && v.plate.toLowerCase().includes(search)) ||
                    (v.phone && v.phone.includes(search))
                );
            }
            
            if (dateFilter) {
                const todayStr = today.toISOString().split('T')[0];
                if (dateFilter === 'today') {
                    visitors = visitors.filter(v => v.date === todayStr);
                } else if (dateFilter === 'week') {
                    const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    visitors = visitors.filter(v => v.date >= weekAgo);
                } else if (dateFilter === 'month') {
                    const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    visitors = visitors.filter(v => v.date >= monthAgo);
                }
            }
            
            if (statusFilter) {
                visitors = visitors.filter(v => statusFilter === 'inside' ? !v.exitTime : v.exitTime);
            }
            
            if (typeFilter) {
                visitors = visitors.filter(v => v.type === typeFilter);
            }
            
            document.getElementById('visitorCount').textContent = visitors.length + ' kayƒ±t';
            renderAllVisitorsTable(visitors);
        }

        function searchVisitors() {
            filterVisitors();
        }

        function renderAllVisitorsTable(visitors) {
            const tbody = document.getElementById('allVisitorsTable');
            if (visitors.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty-state">Kayƒ±t bulunamadƒ±</td></tr>';
                return;
            }
            
            visitors.sort((a, b) => new Date(b.entryTime) - new Date(a.entryTime));
            
            tbody.innerHTML = visitors.map(v => `
                <tr>
                    <td>${formatDate(v.date)}</td>
                    <td>${v.firstName} ${v.lastName}</td>
                    <td>${v.company || '-'}</td>
                    <td>${v.plate || '-'}</td>
                    <td>${v.phone || '-'}</td>
                    <td><span class="type-badge type-${v.type}">${getTypeName(v.type)}</span></td>
                    <td>${formatTime(v.entryTime)}</td>
                    <td>${v.exitTime ? formatTime(v.exitTime) : '-'}</td>
                    <td><span class="status-badge ${v.exitTime ? 'status-outside' : 'status-inside'}">${v.exitTime ? '√áƒ±kƒ±≈ü' : 'ƒ∞√ßeride'}</span></td>
                    <td class="action-buttons">
                        ${!v.exitTime ? `<button class="btn btn-sm btn-success" onclick="checkoutVisitor('${v.id}')">√áƒ±kƒ±≈ü</button>` : ''}
                        <button class="btn btn-sm btn-warning" onclick="editVisitor('${v.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteVisitor('${v.id}')">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        // Visitor CRUD
        let additionalPersons = [];

        function openVisitorModal() {
            document.getElementById('visitorModalTitle').textContent = 'Yeni Ziyaret√ßi';
            document.getElementById('visitorId').value = '';
            document.getElementById('visitorFirstName').value = '';
            document.getElementById('visitorLastName').value = '';
            document.getElementById('visitorCompany').value = '';
            document.getElementById('visitorPhone').value = '';
            document.getElementById('visitorPlate').value = '';
            document.getElementById('visitorType').value = 'sevkiyat';
            document.getElementById('visitorContact').value = '';
            document.getElementById('visitorNote').value = '';
            additionalPersons = [];
            renderAdditionalPersons();
            openModal('visitorModal');
        }

        function addAdditionalPerson() {
            additionalPersons.push({ name: '' });
            renderAdditionalPersons();
        }

        function renderAdditionalPersons() {
            const container = document.getElementById('additionalPersonsList');
            container.innerHTML = additionalPersons.map((p, i) => `
                <div class="additional-person-item">
                    <input type="text" class="form-control" style="flex: 1;" placeholder="Ad Soyad" value="${p.name}" onchange="updateAdditionalPerson(${i}, this.value)">
                    <button class="btn btn-sm btn-danger" onclick="removeAdditionalPerson(${i})">‚úï</button>
                </div>
            `).join('');
        }

        function updateAdditionalPerson(index, value) {
            additionalPersons[index].name = value;
        }

        function removeAdditionalPerson(index) {
            additionalPersons.splice(index, 1);
            renderAdditionalPersons();
        }

        function saveVisitor() {
            const id = document.getElementById('visitorId').value;
            const firstName = document.getElementById('visitorFirstName').value.trim();
            const lastName = document.getElementById('visitorLastName').value.trim();
            
            if (!firstName || !lastName) {
                showToast('Ad ve Soyad zorunludur', 'error');
                return;
            }
            
            const visitors = getData('visitors') || [];
            const now = getTurkeyTime();
            
            const visitorData = {
                firstName,
                lastName,
                company: document.getElementById('visitorCompany').value.trim(),
                phone: document.getElementById('visitorPhone').value.trim(),
                plate: document.getElementById('visitorPlate').value.trim().toUpperCase(),
                type: document.getElementById('visitorType').value,
                contact: document.getElementById('visitorContact').value.trim(),
                note: document.getElementById('visitorNote').value.trim(),
                additionalPersons: additionalPersons.filter(p => p.name.trim())
            };
            
            if (id) {
                const index = visitors.findIndex(v => v.id === id);
                if (index !== -1) {
                    visitors[index] = { ...visitors[index], ...visitorData };
                    addLog(`Ziyaret√ßi g√ºncellendi: ${firstName} ${lastName}`);
                }
            } else {
                visitorData.id = Date.now().toString();
                visitorData.date = now.toISOString().split('T')[0];
                visitorData.entryTime = now.toISOString();
                visitorData.exitTime = null;
                visitors.push(visitorData);
                addLog(`Yeni ziyaret√ßi eklendi: ${firstName} ${lastName}`);
            }
            
            setData('visitors', visitors);
            closeModal('visitorModal');
            showToast(id ? 'Ziyaret√ßi g√ºncellendi' : 'Ziyaret√ßi eklendi');
            loadDashboard();
            loadVisitors();
        }

        function editVisitor(id) {
            const visitors = getData('visitors') || [];
            const visitor = visitors.find(v => v.id === id);
            if (!visitor) return;
            
            document.getElementById('visitorModalTitle').textContent = 'Ziyaret√ßi D√ºzenle';
            document.getElementById('visitorId').value = visitor.id;
            document.getElementById('visitorFirstName').value = visitor.firstName;
            document.getElementById('visitorLastName').value = visitor.lastName;
            document.getElementById('visitorCompany').value = visitor.company || '';
            document.getElementById('visitorPhone').value = visitor.phone || '';
            document.getElementById('visitorPlate').value = visitor.plate || '';
            document.getElementById('visitorType').value = visitor.type;
            document.getElementById('visitorContact').value = visitor.contact || '';
            document.getElementById('visitorNote').value = visitor.note || '';
            additionalPersons = visitor.additionalPersons || [];
            renderAdditionalPersons();
            openModal('visitorModal');
        }

        function checkoutVisitor(id) {
            const visitors = getData('visitors') || [];
            const index = visitors.findIndex(v => v.id === id);
            if (index !== -1) {
                visitors[index].exitTime = getTurkeyTime().toISOString();
                setData('visitors', visitors);
                addLog(`Ziyaret√ßi √ßƒ±kƒ±≈ü yaptƒ±: ${visitors[index].firstName} ${visitors[index].lastName}`);
                showToast('√áƒ±kƒ±≈ü kaydedildi');
                loadDashboard();
                loadVisitors();
                loadInsideVisitors();
            }
        }

        function deleteVisitor(id) {
            showConfirm('Bu ziyaret√ßiyi silmek istediƒüinize emin misiniz?', () => {
                const visitors = getData('visitors') || [];
                const visitor = visitors.find(v => v.id === id);
                const filtered = visitors.filter(v => v.id !== id);
                setData('visitors', filtered);
                if (visitor) addLog(`Ziyaret√ßi silindi: ${visitor.firstName} ${visitor.lastName}`);
                showToast('Ziyaret√ßi silindi');
                loadDashboard();
                loadVisitors();
            });
        }

        // Autocomplete
        function showAutocomplete(input, field) {
            const value = input.value.toLowerCase();
            const list = document.getElementById('autocomplete-' + field);
            
            if (value.length < 2) {
                list.classList.remove('active');
                return;
            }
            
            const visitors = getData('visitors') || [];
            let suggestions = [];
            
            if (field === 'firstName') {
                suggestions = [...new Set(visitors.map(v => v.firstName))].filter(n => n.toLowerCase().includes(value));
            } else if (field === 'company') {
                suggestions = [...new Set(visitors.map(v => v.company).filter(Boolean))].filter(c => c.toLowerCase().includes(value));
            } else if (field === 'plate') {
                suggestions = [...new Set(visitors.map(v => v.plate).filter(Boolean))].filter(p => p.toLowerCase().includes(value));
            }
            
            if (suggestions.length === 0) {
                list.classList.remove('active');
                return;
            }
            
            list.innerHTML = suggestions.slice(0, 5).map(s => `
                <div class="autocomplete-item" onclick="selectAutocomplete('${field}', '${s}')">${s}</div>
            `).join('');
            list.classList.add('active');
        }

        function selectAutocomplete(field, value) {
            const fieldMap = { firstName: 'visitorFirstName', company: 'visitorCompany', plate: 'visitorPlate' };
            document.getElementById(fieldMap[field]).value = value;
            document.getElementById('autocomplete-' + field).classList.remove('active');
            
            // If firstName selected, try to autofill other fields
            if (field === 'firstName') {
                const visitors = getData('visitors') || [];
                const match = visitors.find(v => v.firstName === value);
                if (match) {
                    document.getElementById('visitorLastName').value = match.lastName || '';
                    document.getElementById('visitorCompany').value = match.company || '';
                    document.getElementById('visitorPhone').value = match.phone || '';
                    document.getElementById('visitorPlate').value = match.plate || '';
                }
            }
        }

        // Inside visitors
        function loadInsideVisitors() {
            const visitors = getData('visitors') || [];
            const inside = visitors.filter(v => !v.exitTime);
            
            document.getElementById('insideVisitorCount').textContent = inside.length + ' ki≈üi';
            
            const container = document.getElementById('insideVisitorsList');
            if (inside.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üö™</div><p>≈ûu anda i√ßeride ziyaret√ßi yok</p></div>';
                return;
            }
            
            container.innerHTML = inside.map(v => `
                <div class="visitor-card">
                    <div class="visitor-card-header">
                        <span class="visitor-name">${v.firstName} ${v.lastName}</span>
                        <span class="type-badge type-${v.type}">${getTypeName(v.type)}</span>
                    </div>
                    <div class="visitor-info">
                        ${v.company ? `<span>üè¢ ${v.company}</span>` : ''}
                        ${v.plate ? `<span>üöó ${v.plate}</span>` : ''}
                        ${v.phone ? `<span>üìû ${v.phone}</span>` : ''}
                        <span>‚è∞ Giri≈ü: ${formatTime(v.entryTime)}</span>
                    </div>
                    <button class="btn btn-success btn-sm" onclick="checkoutVisitor('${v.id}')" style="width: 100%;">√áƒ±kƒ±≈ü Yap</button>
                </div>
            `).join('');
        }

        // Personnel
        function loadPersonnel() {
            const personnel = getData('personnel') || [];
            const settings = getData('settings');
            
            const companyPersonnel = personnel.filter(p => p.category === 'company');
            const projectPersonnel = personnel.filter(p => p.category === 'project');
            
            renderPersonnelList('companyList', companyPersonnel);
            renderPersonnelList('projectList', projectPersonnel);
        }

        function renderPersonnelList(containerId, personnel) {
            const container = document.getElementById(containerId);
            if (personnel.length === 0) {
                container.innerHTML = '<div class="empty-state" style="padding: 20px;"><p>Personel yok</p></div>';
                return;
            }
            
            container.innerHTML = personnel.map(p => `
                <div class="personnel-item" draggable="true" ondragstart="dragPersonnel(event, '${p.id}')">
                    <div class="personnel-item-name">${p.firstName} ${p.lastName}</div>
                    <div class="personnel-item-info">
                        ${p.position ? `<span>üíº ${p.position}</span>` : ''}
                        ${p.phone ? `<span> ‚Ä¢ üìû ${p.phone}</span>` : ''}
                        ${p.plate ? `<span> ‚Ä¢ üöó ${p.plate}</span>` : ''}
                    </div>
                    <div class="action-buttons" style="margin-top: 8px;">
                        <button class="btn btn-sm btn-warning" onclick="editPersonnel('${p.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePersonnel('${p.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Drag and drop
        let draggedPersonnelId = null;

        function dragPersonnel(event, id) {
            draggedPersonnelId = id;
            event.target.classList.add('dragging');
        }

        function allowDrop(event) {
            event.preventDefault();
            event.target.closest('.personnel-list').classList.add('drag-over');
        }

        function dragLeave(event) {
            event.target.closest('.personnel-list')?.classList.remove('drag-over');
        }

        function dropPersonnel(event, category) {
            event.preventDefault();
            event.target.closest('.personnel-list').classList.remove('drag-over');
            
            if (!draggedPersonnelId) return;
            
            const personnel = getData('personnel') || [];
            const index = personnel.findIndex(p => p.id === draggedPersonnelId);
            if (index !== -1) {
                personnel[index].category = category;
                setData('personnel', personnel);
                addLog(`Personel ta≈üƒ±ndƒ±: ${personnel[index].firstName} ${personnel[index].lastName} -> ${category === 'company' ? '≈ûirket' : 'Proje'}`);
                loadPersonnel();
            }
            
            draggedPersonnelId = null;
        }

        function openPersonnelModal() {
            document.getElementById('personnelModalTitle').textContent = 'Yeni Personel';
            document.getElementById('personnelId').value = '';
            document.getElementById('personnelFirstName').value = '';
            document.getElementById('personnelLastName').value = '';
            document.getElementById('personnelPosition').value = '';
            document.getElementById('personnelPhone').value = '';
            document.getElementById('personnelPlate').value = '';
            document.getElementById('personnelCategory').value = 'company';
            openModal('personnelModal');
        }

        function savePersonnel() {
            const id = document.getElementById('personnelId').value;
            const firstName = document.getElementById('personnelFirstName').value.trim();
            const lastName = document.getElementById('personnelLastName').value.trim();
            
            if (!firstName || !lastName) {
                showToast('Ad ve Soyad zorunludur', 'error');
                return;
            }
            
            const personnel = getData('personnel') || [];
            
            const personnelData = {
                firstName,
                lastName,
                position: document.getElementById('personnelPosition').value.trim(),
                phone: document.getElementById('personnelPhone').value.trim(),
                plate: document.getElementById('personnelPlate').value.trim().toUpperCase(),
                category: document.getElementById('personnelCategory').value
            };
            
            if (id) {
                const index = personnel.findIndex(p => p.id === id);
                if (index !== -1) {
                    personnel[index] = { ...personnel[index], ...personnelData };
                    addLog(`Personel g√ºncellendi: ${firstName} ${lastName}`);
                }
            } else {
                personnelData.id = Date.now().toString();
                personnel.push(personnelData);
                addLog(`Yeni personel eklendi: ${firstName} ${lastName}`);
            }
            
            setData('personnel', personnel);
            closeModal('personnelModal');
            showToast(id ? 'Personel g√ºncellendi' : 'Personel eklendi');
            loadPersonnel();
        }

        function editPersonnel(id) {
            const personnel = getData('personnel') || [];
            const person = personnel.find(p => p.id === id);
            if (!person) return;
            
            document.getElementById('personnelModalTitle').textContent = 'Personel D√ºzenle';
            document.getElementById('personnelId').value = person.id;
            document.getElementById('personnelFirstName').value = person.firstName;
            document.getElementById('personnelLastName').value = person.lastName;
            document.getElementById('personnelPosition').value = person.position || '';
            document.getElementById('personnelPhone').value = person.phone || '';
            document.getElementById('personnelPlate').value = person.plate || '';
            document.getElementById('personnelCategory').value = person.category;
            openModal('personnelModal');
        }

        function deletePersonnel(id) {
            showConfirm('Bu personeli silmek istediƒüinize emin misiniz?', () => {
                const personnel = getData('personnel') || [];
                const person = personnel.find(p => p.id === id);
                const filtered = personnel.filter(p => p.id !== id);
                setData('personnel', filtered);
                if (person) addLog(`Personel silindi: ${person.firstName} ${person.lastName}`);
                showToast('Personel silindi');
                loadPersonnel();
            });
        }

        // Notes
        function loadNotes() {
            const notes = getData('notes') || [];
            const container = document.getElementById('notesList');
            
            if (notes.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Hen√ºz not yok</p></div>';
                return;
            }
            
            const now = getTurkeyTime();
            container.innerHTML = notes.map(note => {
                const createdAt = new Date(note.createdAt);
                const hoursSince = (now - createdAt) / (1000 * 60 * 60);
                const isNew = hoursSince < 24;
                
                return `
                    <div class="note-card ${note.read ? '' : 'unread'}">
                        ${isNew ? '<span class="note-new-badge">YENƒ∞</span>' : ''}
                        <div class="note-title">${note.title}</div>
                        <div class="note-content">${note.content}</div>
                        ${note.image ? `<img src="${note.image}" style="max-width: 200px; margin: 10px 0; border-radius: 8px; cursor: pointer;" onclick="viewImage('${note.image}', '${note.title}')">` : ''}
                        <div class="note-footer">
                            <span>üìÖ ${formatDateTime(note.createdAt)}${note.endDate ? ` ‚Ä¢ Biti≈ü: ${formatDate(note.endDate)}` : ''}</span>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-info" onclick="toggleNoteRead('${note.id}')">${note.read ? 'üìñ' : 'üìï'}</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteNote('${note.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openNoteModal() {
            document.getElementById('noteId').value = '';
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            document.getElementById('noteEndDate').value = '';
            document.getElementById('noteImage').value = '';
            openModal('noteModal');
        }

        function saveNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            
            if (!title || !content) {
                showToast('Ba≈ülƒ±k ve i√ßerik zorunludur', 'error');
                return;
            }
            
            const notes = getData('notes') || [];
            const imageInput = document.getElementById('noteImage');
            
            const saveNoteData = (imageData) => {
                const noteData = {
                    id: Date.now().toString(),
                    title,
                    content,
                    endDate: document.getElementById('noteEndDate').value || null,
                    image: imageData,
                    read: false,
                    createdAt: getTurkeyTime().toISOString()
                };
                
                notes.unshift(noteData);
                setData('notes', notes);
                addLog(`Yeni not eklendi: ${title}`);
                closeModal('noteModal');
                showToast('Not eklendi');
                loadNotes();
            };
            
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => saveNoteData(e.target.result);
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                saveNoteData(null);
            }
        }

        function toggleNoteRead(id) {
            const notes = getData('notes') || [];
            const index = notes.findIndex(n => n.id === id);
            if (index !== -1) {
                notes[index].read = !notes[index].read;
                setData('notes', notes);
                loadNotes();
            }
        }

        function deleteNote(id) {
            showConfirm('Bu notu silmek istediƒüinize emin misiniz?', () => {
                const notes = getData('notes') || [];
                const filtered = notes.filter(n => n.id !== id);
                setData('notes', filtered);
                addLog('Not silindi');
                showToast('Not silindi');
                loadNotes();
            });
        }

        function deleteAllNotes() {
            showConfirm('T√ºm notlarƒ± silmek istediƒüinize emin misiniz?', () => {
                setData('notes', []);
                addLog('T√ºm notlar silindi');
                showToast('T√ºm notlar silindi');
                loadNotes();
            });
        }

        // Announcements
        function loadAnnouncements() {
            const announcements = getData('announcements') || [];
            const now = getTurkeyTime();
            
            // Filter active announcements
            const active = announcements.filter(a => !a.endDate || new Date(a.endDate) >= now);
            
            // Scrolling announcements
            const scrolling = active.filter(a => a.type === 'scrolling');
            const scrollingBar = document.getElementById('scrollingAnnouncement');
            if (scrolling.length > 0) {
                document.getElementById('scrollingText').textContent = scrolling.map(a => a.text).join(' ‚Ä¢ ');
                scrollingBar.style.display = 'block';
            } else {
                scrollingBar.style.display = 'none';
            }
            
            // Pinned announcements
            const pinned = active.filter(a => a.type === 'pinned');
            const pinnedContainer = document.getElementById('pinnedAnnouncements');
            pinnedContainer.innerHTML = pinned.map(a => `
                <div class="announcement-pinned">
                    <div class="announcement-pinned-title">üìå Sabit Duyuru</div>
                    <p>${a.text}</p>
                </div>
            `).join('');
            
            // All announcements list
            const container = document.getElementById('announcementsList');
            if (announcements.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì¢</div><p>Hen√ºz duyuru yok</p></div>';
                return;
            }
            
            container.innerHTML = announcements.map(a => `
                <div class="note-card">
                    <div class="note-title">${a.type === 'scrolling' ? 'üîÑ Kayan' : 'üìå Sabit'} Duyuru</div>
                    <div class="note-content">${a.text}</div>
                    <div class="note-footer">
                        <span>üìÖ ${formatDateTime(a.createdAt)}${a.endDate ? ` ‚Ä¢ Biti≈ü: ${formatDate(a.endDate)}` : ''}</span>
                        <button class="btn btn-sm btn-danger" onclick="deleteAnnouncement('${a.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function openAnnouncementModal() {
            document.getElementById('announcementId').value = '';
            document.getElementById('announcementText').value = '';
            document.getElementById('announcementType').value = 'scrolling';
            document.getElementById('announcementEndDate').value = '';
            openModal('announcementModal');
        }

        function saveAnnouncement() {
            const text = document.getElementById('announcementText').value.trim();
            
            if (!text) {
                showToast('Duyuru metni zorunludur', 'error');
                return;
            }
            
            const announcements = getData('announcements') || [];
            
            announcements.unshift({
                id: Date.now().toString(),
                text,
                type: document.getElementById('announcementType').value,
                endDate: document.getElementById('announcementEndDate').value || null,
                createdAt: getTurkeyTime().toISOString()
            });
            
            setData('announcements', announcements);
            addLog('Yeni duyuru eklendi');
            closeModal('announcementModal');
            showToast('Duyuru eklendi');
            loadAnnouncements();
        }

        function deleteAnnouncement(id) {
            showConfirm('Bu duyuruyu silmek istediƒüinize emin misiniz?', () => {
                const announcements = getData('announcements') || [];
                const filtered = announcements.filter(a => a.id !== id);
                setData('announcements', filtered);
                addLog('Duyuru silindi');
                showToast('Duyuru silindi');
                loadAnnouncements();
            });
        }

        // Puantaj
        function loadPuantaj() {
            const puantaj = getData('puantaj') || [];
            const monthFilter = document.getElementById('puantajMonth').value;
            
            let filtered = puantaj;
            if (monthFilter) {
                filtered = puantaj.filter(p => p.date.startsWith(monthFilter));
            }
            
            const container = document.getElementById('puantajList');
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üñºÔ∏è</div><p>Puantaj kaydƒ± yok</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(p => `
                <div class="puantaj-item" onclick="viewImage('${p.image}', '${formatDate(p.date)}')">
                    <img src="${p.image}" alt="Puantaj">
                    <div class="puantaj-item-info">
                        <strong>${formatDate(p.date)}</strong>
                        ${p.description ? `<br><small>${p.description}</small>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function filterPuantaj() {
            loadPuantaj();
        }

        function openPuantajModal() {
            document.getElementById('puantajDate').value = getTurkeyTime().toISOString().split('T')[0];
            document.getElementById('puantajImage').value = '';
            document.getElementById('puantajDescription').value = '';
            openModal('puantajModal');
        }

        function savePuantaj() {
            const date = document.getElementById('puantajDate').value;
            const imageInput = document.getElementById('puantajImage');
            
            if (!date || !imageInput.files || !imageInput.files[0]) {
                showToast('Tarih ve resim zorunludur', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const puantaj = getData('puantaj') || [];
                puantaj.unshift({
                    id: Date.now().toString(),
                    date,
                    image: e.target.result,
                    description: document.getElementById('puantajDescription').value.trim(),
                    createdAt: getTurkeyTime().toISOString()
                });
                setData('puantaj', puantaj);
                addLog('Puantaj eklendi: ' + formatDate(date));
                closeModal('puantajModal');
                showToast('Puantaj eklendi');
                loadPuantaj();
            };
            reader.readAsDataURL(imageInput.files[0]);
        }

        function viewImage(src, title) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModalTitle').textContent = title;
            openModal('imageModal');
        }

        // Shift
        function loadShift() {
            const settings = getData('settings');
            document.getElementById('shiftStartDate').value = settings.shiftStartDate;
            
            renderShiftCalendar();
            loadJokers();
        }

        function renderShiftCalendar() {
            const settings = getData('settings');
            const startDate = new Date(settings.shiftStartDate);
            const today = getTurkeyTime();
            
            const container = document.getElementById('shiftCalendar');
            const days = [];
            
            for (let i = 0; i < 6; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const diffTime = date.getTime() - startDate.getTime();
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                const cycleDay = ((diffDays % 6) + 6) % 6;
                
                let shiftType, shiftClass;
                if (cycleDay < 2) {
                    shiftType = '‚òÄÔ∏è G√ºnd√ºz';
                    shiftClass = 'vardiya-gunduz';
                } else if (cycleDay < 4) {
                    shiftType = 'üåô Gece';
                    shiftClass = 'vardiya-gece';
                } else {
                    shiftType = 'üå¥ Tatil';
                    shiftClass = 'vardiya-tatil';
                }
                
                const isToday = date.toDateString() === today.toDateString();
                const dayNames = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];
                
                days.push(`
                    <div class="shift-day ${isToday ? 'today' : ''}">
                        <div class="shift-day-name">${dayNames[date.getDay()]}</div>
                        <div class="shift-day-date">${date.getDate()}/${date.getMonth() + 1}</div>
                        <span class="shift-type ${shiftClass}">${shiftType}</span>
                    </div>
                `);
            }
            
            container.innerHTML = days.join('');
        }

        function saveShiftSettings() {
            const settings = getData('settings');
            settings.shiftStartDate = document.getElementById('shiftStartDate').value;
            setData('settings', settings);
            addLog('Vardiya ayarlarƒ± g√ºncellendi');
            showToast('Vardiya ayarlarƒ± kaydedildi');
            renderShiftCalendar();
            updateClock();
        }

        // Jokers
        function loadJokers() {
            const jokers = getData('jokers') || [];
            const container = document.getElementById('jokerList');
            
            if (jokers.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">Joker personel tanƒ±mlanmamƒ±≈ü</p>';
                return;
            }
            
            container.innerHTML = jokers.map(j => `
                <div class="additional-person-item">
                    <span>${j.name}</span>
                    <button class="btn btn-sm btn-danger" onclick="deleteJoker('${j.id}')">‚úï</button>
                </div>
            `).join('');
        }

        function openJokerModal() {
            document.getElementById('jokerName').value = '';
            openModal('jokerModal');
        }

        function saveJoker() {
            const name = document.getElementById('jokerName').value.trim();
            if (!name) {
                showToast('Ad Soyad zorunludur', 'error');
                return;
            }
            
            const jokers = getData('jokers') || [];
            jokers.push({ id: Date.now().toString(), name });
            setData('jokers', jokers);
            addLog('Joker personel eklendi: ' + name);
            closeModal('jokerModal');
            showToast('Joker personel eklendi');
            loadJokers();
        }

        function deleteJoker(id) {
            const jokers = getData('jokers') || [];
            const filtered = jokers.filter(j => j.id !== id);
            setData('jokers', filtered);
            addLog('Joker personel silindi');
            showToast('Joker personel silindi');
            loadJokers();
        }

        // Logs
        function loadLogs() {
            const logs = getData('logs') || [];
            const container = document.getElementById('logsList');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>ƒ∞≈ülem ge√ßmi≈üi bo≈ü</p></div>';
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="log-entry">
                    <span class="log-time">${formatDateTime(log.timestamp)}</span>
                    <span class="log-action">${log.action}</span>
                </div>
            `).join('');
        }

        function clearOldLogs() {
            const logs = getData('logs') || [];
            const weekAgo = new Date(getTurkeyTime().getTime() - 7 * 24 * 60 * 60 * 1000);
            const filtered = logs.filter(log => new Date(log.timestamp) > weekAgo);
            setData('logs', filtered);
            showToast('Eski loglar temizlendi');
            loadLogs();
        }

        // Settings
        function loadSettings() {
            const visitors = getData('visitors') || [];
            const personnel = getData('personnel') || [];
            const notes = getData('notes') || [];
            const announcements = getData('announcements') || [];
            const logs = getData('logs') || [];
            
            document.getElementById('statsVisitors').textContent = visitors.length;
            document.getElementById('statsPersonnel').textContent = personnel.length;
            document.getElementById('statsNotes').textContent = notes.length;
            document.getElementById('statsAnnouncements').textContent = announcements.length;
            document.getElementById('statsLogs').textContent = logs.length;
        }

        // Export/Import
        function exportToExcel() {
            const visitors = getData('visitors') || [];
            if (visitors.length === 0) {
                showToast('Dƒ±≈üa aktarƒ±lacak veri yok', 'warning');
                return;
            }
            
            let csv = 'Tarih,Ad,Soyad,Firma,Plaka,Telefon,T√ºr,Giri≈ü Saati,√áƒ±kƒ±≈ü Saati,Durum\n';
            visitors.forEach(v => {
                csv += `${v.date},${v.firstName},${v.lastName},${v.company || ''},${v.plate || ''},${v.phone || ''},${getTypeName(v.type)},${formatTime(v.entryTime)},${v.exitTime ? formatTime(v.exitTime) : ''},${v.exitTime ? '√áƒ±kƒ±≈ü' : 'ƒ∞√ßeride'}\n`;
            });
            
            downloadFile(csv, 'ziyaretci_listesi.csv', 'text/csv');
            addLog('Excel export yapƒ±ldƒ±');
            showToast('Excel dosyasƒ± indirildi');
        }

        function exportAllData() {
            const data = {
                visitors: getData('visitors') || [],
                personnel: getData('personnel') || [],
                notes: getData('notes') || [],
                announcements: getData('announcements') || [],
                puantaj: getData('puantaj') || [],
                logs: getData('logs') || [],
                jokers: getData('jokers') || [],
                settings: getData('settings'),
                exportDate: getTurkeyTime().toISOString()
            };
            
            downloadFile(JSON.stringify(data, null, 2), 'zts_yedek_' + getTurkeyTime().toISOString().split('T')[0] + '.json', 'application/json');
            addLog('T√ºm veriler dƒ±≈üa aktarƒ±ldƒ±');
            showToast('Yedek dosyasƒ± indirildi');
        }

        function importAllData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    showConfirm('Mevcut veriler silinecek ve yedeƒüe aktarƒ±lacak. Emin misiniz?', () => {
                        if (data.visitors) setData('visitors', data.visitors);
                        if (data.personnel) setData('personnel', data.personnel);
                        if (data.notes) setData('notes', data.notes);
                        if (data.announcements) setData('announcements', data.announcements);
                        if (data.puantaj) setData('puantaj', data.puantaj);
                        if (data.logs) setData('logs', data.logs);
                        if (data.jokers) setData('jokers', data.jokers);
                        if (data.settings) setData('settings', data.settings);
                        
                        addLog('Veriler i√ße aktarƒ±ldƒ±');
                        showToast('Veriler ba≈üarƒ±yla i√ße aktarƒ±ldƒ±');
                        loadDashboard();
                        loadTheme();
                    });
                } catch (error) {
                    showToast('Ge√ßersiz dosya formatƒ±', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            showConfirm('T√úM VERƒ∞LER Sƒ∞Lƒ∞NECEK! Bu i≈ülem geri alƒ±namaz. Emin misiniz?', () => {
                localStorage.clear();
                initData();
                addLog('T√ºm veriler silindi');
                showToast('T√ºm veriler silindi');
                loadDashboard();
            });
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Confirm dialog
        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmButton').onclick = () => {
                closeModal('confirmModal');
                callback();
            };
            openModal('confirmModal');
        }

        // Category name edit
        function editCategoryName(category) {
            const settings = getData('settings');
            const currentName = settings.categoryNames[category];
            const newName = prompt('Yeni kategori adƒ±:', currentName);
            if (newName && newName.trim()) {
                settings.categoryNames[category] = newName.trim();
                setData('settings', settings);
                document.querySelector(`#${category}-personnel .personnel-category-header h4`).textContent = 
                    (category === 'company' ? 'üè¢ ' : 'üìÅ ') + newName.trim();
                showToast('Kategori adƒ± g√ºncellendi');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initData();
            loadTheme();
            updateClock();
            setInterval(updateClock, 1000);
            loadDashboard();
            loadAnnouncements();
            
            // Close autocomplete on click outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.form-group')) {
                    document.querySelectorAll('.autocomplete-list').forEach(list => {
                        list.classList.remove('active');
                    });
                }
            });
            
            // Set default month filter for puantaj
            const now = getTurkeyTime();
            document.getElementById('puantajMonth').value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
        });

        // Close modal on backdrop click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
